<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QULTURE — Drop 01</title>
  <meta name="description"
    content="QULTURE Drop 01 — лимитированный pre-order. Handmade in Kazakhstan. Оформление через WhatsApp.">

  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="apple-touch-icon" href="favicon.png">

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap');

    html {
      scroll-behavior: smooth;
    }

    /* ===== Global font: Helvetica across the page ===== */
    body {
      font-family: "Helvetica Neue", Helvetica, Arial, system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      background: #000;
      color: #fff;
    }

    .mono {
      font-family: 'JetBrains Mono', monospace;
    }

    :root {
      --ease: cubic-bezier(.2, .8, .2, 1);
    }

    /* make everything sharp */
    * {
      border-radius: 0 !important;
    }

    /* remove shadows (flat) */
    .shadow,
    .shadow-md,
    .shadow-lg,
    .shadow-xl {
      box-shadow: none !important;
    }

    /* sharp borders (no opacity on element) */
    .border-white\/10 {
      border-color: rgba(255, 255, 255, .10) !important;
    }

    .border-white\/12 {
      border-color: rgba(255, 255, 255, .12) !important;
    }

    .border-white\/16 {
      border-color: rgba(255, 255, 255, .16) !important;
    }

    .border-white\/18 {
      border-color: rgba(255, 255, 255, .18) !important;
    }

    .border-white\/20 {
      border-color: rgba(255, 255, 255, .20) !important;
    }

    .border-white\/22 {
      border-color: rgba(255, 255, 255, .22) !important;
    }

    .border-white\/32 {
      border-color: rgba(255, 255, 255, .32) !important;
    }

    .border-white\/35 {
      border-color: rgba(255, 255, 255, .35) !important;
    }

    .border-white\/42 {
      border-color: rgba(255, 255, 255, .42) !important;
    }

    .border-white\/45 {
      border-color: rgba(255, 255, 255, .45) !important;
    }

    /* overlays must stay translucent */
    #drawerOverlay {
      background: rgba(0, 0, 0, .65) !important;
    }

    #sizeOverlay {
      background: rgba(0, 0, 0, .72) !important;
    }

    /* TYPO SYSTEM */
    .helv {
      font-family: "Helvetica Neue", Helvetica, Arial, system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
    }

    .helv-bold {
      font-family: "Helvetica Neue", Helvetica, Arial, system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      font-weight: 700;
    }

    .helv-reg {
      font-family: "Helvetica Neue", Helvetica, Arial, system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      font-weight: 400;
    }

    /* HERO TITLE: Helvetica Bold, LS -6, LH 50 */
    .hero-title {
      font-family: "Helvetica Neue", Helvetica, Arial, system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      font-weight: 700;
      letter-spacing: -6px;
      line-height: 50px;
    }

    @media (max-width: 640px) {
      .hero-title {
        line-height: 40px;
        letter-spacing: -4px;
      }
    }

    /* BRAND "QULTURE": Helvetica Bold, LS -6 */
    .brand-title {
      font-family: "Helvetica Neue", Helvetica, Arial, system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      font-weight: 700;
      letter-spacing: -6px;
    }

    @media (max-width: 640px) {
      .brand-title {
        letter-spacing: -4px;
      }
    }

    /* DROP 01: Helvetica Bold, size 11, LS 1.1 */
    .drop-11 {
      font-family: "Helvetica Neue", Helvetica, Arial, system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      font-weight: 700;
      font-size: 11px;
      letter-spacing: 1.1px;
    }

    /* CTA */
    .cta-helv {
      font-family: "Helvetica Neue", Helvetica, Arial, system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      font-weight: 700;
      letter-spacing: -1px;
    }

    .section-helv {
      font-family: "Helvetica Neue", Helvetica, Arial, system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      font-weight: 700;
      letter-spacing: -6px;
    }

    @media (max-width: 640px) {
      .section-helv {
        letter-spacing: -4px;
      }
    }

    .contacts-helv {
      font-family: "Helvetica Neue", Helvetica, Arial, system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      font-weight: 700;
      letter-spacing: -1px;
    }

    /* ====== MODALS ====== */
    .modal {
      display: none;
    }

    .modal.is-open {
      display: block;
    }

    .modal-card {
      border: 1px solid rgba(255, 255, 255, .18);
      background: #000;
      overflow: hidden;
    }

    .modal-shell {
      max-height: calc(100dvh - 24px);
      width: min(980px, calc(100vw - 24px));
    }

    .modal-body {
      max-height: calc(100dvh - 140px);
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    /* reveal */
    .reveal {
      opacity: 0;
      transform: translateY(14px);
      transition: opacity .6s var(--ease), transform .6s var(--ease);
      will-change: opacity, transform;
    }

    .reveal.is-in {
      opacity: 1;
      transform: translateY(0);
    }

    .reveal.delay-1 {
      transition-delay: .08s;
    }

    .reveal.delay-2 {
      transition-delay: .16s;
    }

    .reveal.delay-3 {
      transition-delay: .24s;
    }

    .product-card {
      transition: border-color .25s var(--ease), transform .25s var(--ease);
    }

    .product-card:hover {
      border-color: rgba(255, 255, 255, .35) !important;
      transform: translateY(-2px);
    }

    /* toast */
    .toast {
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%) translateY(10px);
      opacity: 0;
      pointer-events: none;
      z-index: 80;
      border: 1px solid rgba(255, 255, 255, .22);
      background: #000;
      padding: 10px 14px;
      transition: opacity .22s var(--ease), transform .22s var(--ease);
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    .shake {
      animation: shake .35s var(--ease);
    }

    @keyframes shake {
      0% {
        transform: translateX(0);
      }

      25% {
        transform: translateX(-6px);
      }

      50% {
        transform: translateX(6px);
      }

      75% {
        transform: translateX(-4px);
      }

      100% {
        transform: translateX(0);
      }
    }

    /* =========================
   FULL-BLEED SWIPE (NO peek, NO counter, NO dots) + arrows
   ========================= */
    .carousel {
      position: relative;
      width: 100%;
      height: 100%;
      background: #000;
    }

    /* важное: без padding, без gap, чисто full */
    .carousel-track {
      display: flex;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      overscroll-behavior-x: contain;
      gap: 0;
      padding: 0;
      height: 100%;
    }

    .carousel-track::-webkit-scrollbar {
      display: none;
    }

    .carousel-slide {
      flex: 0 0 100%;
      scroll-snap-align: start;
      height: 100%;
    }

    /* картинка во всю, без рамок */
    .carousel-slide img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      user-select: none;
      -webkit-user-drag: none;
    }

    /* стрелки */
    .carousel-arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid rgba(255, 255, 255, .22);
      background: rgba(0, 0, 0, .55);
      color: #fff;
      opacity: .9;
      transition: transform .2s var(--ease), opacity .2s var(--ease), border-color .2s var(--ease);
      user-select: none;
      z-index: 5;
    }

    .carousel-arrow:hover {
      transform: translateY(-50%) scale(1.04);
      opacity: 1;
      border-color: rgba(255, 255, 255, .45);
    }

    .carousel-prev {
      left: 12px;
    }

    .carousel-next {
      right: 12px;
    }


    @media (max-width: 768px) {
      .carousel-arrow {
        display: none;
      }

      /* если хочешь скрывать стрелки на мобилке */
      .carousel-track {
        padding-right: 0;
      }

      .carousel-slide {
        flex-basis: 100%;
      }
    }

    /* pagination dots */
    .carousel-dots {
      position: absolute;
      left: 50%;
      bottom: 10px;
      transform: translateX(-50%);
      display: flex;
      gap: 6px;
      z-index: 6;
      padding: 6px 10px;
      background: rgba(0, 0, 0, .25);
      border: 1px solid rgba(255, 255, 255, .12);
    }

    .carousel-dot {
      width: 18px;
      /* “черточки”, не кружки */
      height: 2px;
      background: rgba(255, 255, 255, .25);
      transition: background .2s var(--ease), transform .2s var(--ease);
    }

    .carousel-dot.is-active {
      background: rgba(255, 255, 255, .85);
      transform: scaleX(1.08);
    }

    /* на десктопе можно оставить, но если хочешь — только на мобилке: */
    @media (min-width: 769px) {
      .carousel-dots {
        display: none;
      }
    }
  </style>
</head>

<body class="selection:bg-white selection:text-black">

  <!-- HEADER -->
  <header class="fixed top-0 left-0 right-0 z-50 bg-black border-b border-white/20">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 py-3 sm:py-4 flex items-center justify-between gap-3">
      <a href="#top" class="flex items-center gap-0.5 sm:gap-1 min-w-0">
        <img src="logo.png" alt="QULTURE logo" class="w-14 h-14 sm:w-16 sm:h-16 object-contain opacity-100">
        <span class="text-lg sm:text-xl md:text-2xl font-bold tracking-tighter truncate brand-title">QULTURE</span>
      </a>

      <nav class="hidden md:flex items-center gap-6 mono text-[11px] uppercase tracking-widest text-gray-400">
        <a href="#products" class="hover:text-white transition-colors">Продукция</a>
        <a href="#buyers" class="hover:text-white transition-colors">Покупателям</a>
        <a href="#contacts" class="hover:text-white transition-colors">Контакты</a>
      </nav>

      <div class="flex items-center gap-2 sm:gap-3 shrink-0">
        <a href="https://wa.me/77471126137" target="_blank" rel="noopener noreferrer"
          class="mono text-[10px] sm:text-[11px] uppercase tracking-widest text-black bg-white px-3 sm:px-4 py-2 hover:opacity-90 transition whitespace-nowrap">
          <span class="hidden sm:inline">WhatsApp</span><span class="sm:hidden">WA</span>
        </a>

        <a href="https://www.instagram.com/qulture.culture" target="_blank" rel="noopener noreferrer"
          class="mono text-[10px] sm:text-[11px] uppercase tracking-widest text-black bg-white px-3 sm:px-4 py-2 hover:opacity-90 transition whitespace-nowrap">
          <span class="hidden sm:inline">Instagram</span><span class="sm:hidden">IG</span>
        </a>

        <button id="cartBtn"
          class="mono text-[10px] sm:text-[11px] uppercase tracking-widest border border-white/20 px-3 sm:px-4 py-2 hover:border-white transition whitespace-nowrap">
          <span>Корзина</span>
          <span id="cartCount" class="text-gray-400">(0)</span>
        </button>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <section id="top" class="pt-24 sm:pt-28 md:pt-32 pb-14 sm:pb-16">
    <div class="max-w-6xl mx-auto px-4 sm:px-6">
      <div class="border border-white/20 p-6 sm:p-8 md:p-12 bg-black reveal">
        <h1 class="text-3xl sm:text-4xl md:text-6xl font-bold tracking-tighter hero-title">
          YOU’RE RUNNING <br class="hidden md:block" /> OUT OF TIME.
        </h1>

        <div class="mono text-gray-400 mt-4 sm:mt-6 drop-11 uppercase">
          Drop 01
        </div>

        <div class="mt-8 sm:mt-10 flex flex-col sm:flex-row gap-3">
          <a href="#products"
            class="inline-flex justify-center items-center bg-white text-black px-7 sm:px-8 py-4 font-bold uppercase tracking-widest cta-helv">
            Смотреть продукцию
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- PRODUCTS -->
  <section id="products" class="py-14 sm:py-16 border-t border-white/20">
    <div class="max-w-6xl mx-auto px-4 sm:px-6">
      <div class="flex items-end justify-between gap-6 mb-7 sm:mb-8 reveal">
        <div>
          <h2 class="text-2xl md:text-3xl font-bold tracking-tighter">Продукция</h2>
          <p class="text-gray-400 mt-2">Добавь в корзину — оформим заказ через WhatsApp.</p>
        </div>
        <div class="mono text-[11px] uppercase tracking-widest text-gray-500 hidden sm:block">Drop 01</div>
      </div>

      <div id="productGrid" class="grid grid-cols-1 place-items-center gap-6"></div>
    </div>
  </section>

  <!-- BUYERS -->
  <section id="buyers" class="py-14 sm:py-16 border-t border-white/20">
    <div class="max-w-6xl mx-auto px-4 sm:px-6">
      <h2 class="text-2xl md:text-3xl font-bold tracking-tighter mb-7 sm:mb-8 section-helv">
        Информация для покупателей
      </h2>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-5 sm:gap-6">
        <div class="p-6 border border-white/20 bg-black">
          <div class="text-[11px] uppercase tracking-widest text-gray-500 mb-3 helv-reg">Как заказать</div>
          <ol class="text-sm text-gray-300 leading-relaxed list-decimal pl-5 space-y-2">
            <li>Добавь товар в корзину</li>
            <li>Нажми «Оформить в WhatsApp»</li>
            <li>Мы уточним размер/доставку</li>
          </ol>
        </div>

        <div class="p-6 border border-white/20 bg-black">
          <div class="text-[11px] uppercase tracking-widest text-gray-500 mb-3 helv-reg">Рассрочка/KASPI RED</div>
          <p class="text-sm text-gray-300 leading-relaxed">
            Если хочешь рассрочку — напиши менеджеру. Подскажем условия и оформим вручную.
          </p>
        </div>

        <div class="p-6 border border-white/20 bg-black">
          <div class="text-[11px] uppercase tracking-widest text-gray-500 mb-3 helv-reg">Доставка</div>
          <p class="text-sm text-gray-300 leading-relaxed">
            По Казахстану и СНГ. Стоимость и сроки зависят от города — уточняем при оформлении.
          </p>
        </div>

        <div class="p-6 border border-white/20 bg-black">
          <div class="text-[11px] uppercase tracking-widest text-gray-500 mb-3 helv-reg">Возврат и обмен</div>
          <p class="text-sm text-gray-300 leading-relaxed">
            Возврат/обмен — в течение 14 дней при сохранении бирки и отсутствии следов носки. По вопросам — пишите в
            WhatsApp.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- CONTACTS -->
  <section id="contacts" class="py-14 sm:py-16 border-t border-white/20">
    <div class="max-w-6xl mx-auto px-4 sm:px-6">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 sm:gap-8 items-start">
        <div class="md:col-span-2 p-7 sm:p-8 border border-white/20 bg-black">
          <h3 class="text-2xl font-bold tracking-tighter contacts-helv">Контакты</h3>

          <div class="mt-6 space-y-4 text-sm text-white">
            <div class="flex flex-wrap items-center gap-2">
              <span class="text-white helv-reg">Instagram:</span>
              <a href="https://www.instagram.com/qulture.culture" target="_blank" rel="noopener noreferrer"
                class="hover:opacity-80 transition helv-reg">
                @qulture.culture
              </a>
            </div>

            <div class="flex flex-wrap items-center gap-2">
              <span class="text-white helv-reg">WhatsApp:</span>
              <a href="https://wa.me/77471126137" target="_blank" rel="noopener noreferrer"
                class="hover:opacity-80 transition helv-reg">
                +7 747 112 61 37
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="border-t border-white/20 relative overflow-hidden">
    <div
      class="max-w-6xl mx-auto px-4 sm:px-6 py-6 md:py-0 md:h-24 flex flex-col md:flex-row items-center justify-between gap-4 mono text-[10px] uppercase tracking-widest text-gray-600 relative">
      <div class="shrink-0 text-white helv-reg normal-case tracking-normal">© 2026 QULTURE.KZ</div>

      <div class="relative w-full md:flex-1 md:h-full flex items-center justify-center h-20 md:h-full">
        <img src="payments.png" alt="Visa / MasterCard"
          class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 h-32 md:h-36 w-auto opacity-90 pointer-events-none" />
      </div>

      <div class="shrink-0 flex flex-wrap justify-center md:justify-end items-center gap-2 text-center">
        <a href="/privacy" class="text-white hover:opacity-80 transition helv-reg normal-case tracking-normal">
          Политика конфиденциальности
        </a>
        <span class="opacity-40 hidden md:inline">/</span>
        <a href="/offer" class="text-white hover:opacity-80 transition helv-reg normal-case tracking-normal">
          Публичная оферта
        </a>
      </div>
    </div>
  </footer>

  <!-- SIZE MODAL -->
  <div id="sizeModal" class="modal fixed inset-0 z-[70]" role="dialog" aria-modal="true" aria-labelledby="sizeTitle">
    <div id="sizeOverlay" class="absolute inset-0 bg-black"></div>

    <div class="relative h-full w-full flex items-center justify-center p-3 sm:p-6">
      <div class="modal-card modal-shell">
        <div
          class="flex items-center justify-between px-5 sm:px-6 py-4 border-b border-white/20 bg-black sticky top-0 z-10">
          <div>
            <div id="sizeTitle" class="text-lg sm:text-xl font-bold tracking-tighter">Таблица размеров</div>
            <div class="mono text-[10px] sm:text-[11px] uppercase tracking-widest text-gray-400 mt-1">Custom M-L / Custom
              L-XL</div>
          </div>

          <button id="closeSize"
            class="mono text-[11px] uppercase tracking-widest text-gray-300 border border-white/20 px-3 py-2 hover:border-white transition">
            Закрыть
          </button>
        </div>

        <div class="p-5 sm:p-6 modal-body">
          <div class="border border-white/20 bg-black p-4 sm:p-5">
            <div class="mono text-[11px] uppercase tracking-widest text-gray-400 mb-3">Measurements (cm)</div>

            <div class="overflow-hidden border border-white/20">
              <table class="w-full text-sm">
                <thead class="bg-black">
                  <tr class="text-left">
                    <th class="py-3 px-3 text-gray-400 font-normal">Параметр</th>
                    <th class="py-3 px-3 text-gray-200 font-normal">Custom M-L</th>
                    <th class="py-3 px-3 text-gray-200 font-normal">Custom L-XL</th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-white/20">
                  <tr>
                    <td class="py-3 px-3 text-gray-400">Ширина груди</td>
                    <td class="py-3 px-3">59</td>
                    <td class="py-3 px-3">63</td>
                  </tr>
                  <tr>
                    <td class="py-3 px-3 text-gray-400">Длина изделия</td>
                    <td class="py-3 px-3">67</td>
                    <td class="py-3 px-3">70</td>
                  </tr>
                  <tr>
                    <td class="py-3 px-3 text-gray-400">Ширина плеча</td>
                    <td class="py-3 px-3">17</td>
                    <td class="py-3 px-3">18</td>
                  </tr>
                  <tr>
                    <td class="py-3 px-3 text-gray-400">Ширина низа</td>
                    <td class="py-3 px-3">58</td>
                    <td class="py-3 px-3">61</td>
                  </tr>
                  <tr>
                    <td class="py-3 px-3 text-gray-400">Длина рукава</td>
                    <td class="py-3 px-3">22</td>
                    <td class="py-3 px-3">24</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="mt-4 text-xs text-gray-400 leading-relaxed">
              * Допуск по ручному пошиву ±1–2 см. Если хочешь “как сидит” — напиши в WhatsApp, поможем подобрать.
            </div>
            <div class="mt-4 text-xs text-gray-400 leading-relaxed">
              * Pазмер M-L пишется как L на футболке, Pазмер L-XL пишется как XL
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- CART DRAWER -->
  <div id="drawer" class="fixed inset-0 z-[60] hidden">
    <div id="drawerOverlay" class="absolute inset-0 bg-black"></div>
    <div
      class="absolute right-0 top-0 h-full w-full sm:w-[420px] bg-black border-l border-white/20 p-6 overflow-y-auto">
      <div class="flex items-center justify-between">
        <div class="text-xl font-bold tracking-tighter">Корзина</div>
        <button id="closeDrawer"
          class="mono text-[11px] uppercase tracking-widest text-gray-400 hover:text-white transition">Закрыть</button>
      </div>

      <div id="cartItems" class="mt-6 space-y-4"></div>

      <div class="mt-6 border-t border-white/20 pt-4">
        <div class="flex items-center justify-between text-sm">
          <span class="mono text-gray-500">Итого:</span>
          <span id="cartTotal" class="font-bold">0 ₸</span>
        </div>

        <button id="drawerCheckout"
          class="mt-4 w-full bg-white text-black px-6 py-3 font-bold uppercase tracking-widest hover:opacity-90 transition">
          Оформить в WhatsApp
        </button>

        <button id="clearCart"
          class="mt-3 w-full border border-white/20 px-6 py-3 font-bold uppercase tracking-widest hover:border-white transition">
          Очистить корзину
        </button>
      </div>
    </div>
  </div>

  <div id="toast" class="toast mono text-[10px] uppercase tracking-widest text-gray-200">Added to cart</div>

  <script>
    const WHATSAPP_NUMBER = "77471126137";
    const CURRENCY = "₸";

    const PRODUCTS = [
      {
        id: "q1",
        name: 'T-SHIRT “YOU’RE RUNNING OUT OF TIME”',
        price: 17000,
        note: "Oversize  /  Unisex",
        images: ["images/boy.jpg","images/girl.jpg","images/tshirt_new.jpg", "images/mmmm.png", "images/macro2.png", "images/macro.png", "images/sostavnik.png"],
        description: `
Характеристики:
• Состав: 95% Хлопок / 5% Эластан (190 г/м²).
• Принт: Износостойкая шелкография.
• Крой: Авторский силуэт QULTURE (собственные лекала).
• Размеры: Custom M-L / Custom L-XL

Производство:
Handmade in Kazakhstan. Каждая вещь кроится и шьется вручную в локальном цеху, а не заказывается готовыми бланками. Мы полностью контролируем процесс: от выбора нитей до финального шва.
        `.trim(),
      },
    ];

    const key = "qulture_cart_v1";
    const $ = (id) => document.getElementById(id);

    function loadCart() {
      try { return JSON.parse(localStorage.getItem(key)) || []; }
      catch { return []; }
    }

    const toastEl = $("toast");
    let toastT = null;
    function toast(msg) {
      if (!toastEl) return;
      toastEl.textContent = msg;
      toastEl.classList.add("show");
      clearTimeout(toastT);
      toastT = setTimeout(() => toastEl.classList.remove("show"), 1200);
    }

    function renderCartBadge() {
      const cart = loadCart();
      $("cartCount").textContent = `(${cart.reduce((s, i) => s + i.qty, 0)})`;
    }

    function saveCart(cart) {
      localStorage.setItem(key, JSON.stringify(cart));
      renderCartBadge();
    }

    function formatPrice(n) {
      return new Intl.NumberFormat("ru-RU").format(n) + " " + CURRENCY;
    }

    function cartTotal(cart) {
      return cart.reduce((s, i) => s + i.price * i.qty, 0);
    }

    function addToCart(productId) {
      const p = PRODUCTS.find(x => x.id === productId);
      if (!p) return;

      const cart = loadCart();
      const existing = cart.find(x => x.id === p.id);
      if (existing) existing.qty += 1;
      else cart.push({ id: p.id, name: p.name, price: p.price, qty: 1 });

      saveCart(cart);
      openDrawer();
      renderCart();
      toast("Added to cart");
    }

    function removeFromCart(productId) {
      const cart = loadCart().filter(x => x.id !== productId);
      saveCart(cart);
      renderCart();
    }

    function changeQty(productId, delta) {
      const cart = loadCart();
      const item = cart.find(x => x.id === productId);
      if (!item) return;
      item.qty += delta;
      if (item.qty <= 0) return removeFromCart(productId);
      saveCart(cart);
      renderCart();
    }

    function clearCart() {
      saveCart([]);
      renderCart();
    }

    function buildWhatsappMessage() {
      const cart = loadCart();
      if (!cart.length) return null;

      const lines = [];
      lines.push("QULTURE — Заявка заказa");
      lines.push("");
      cart.forEach((i, idx) => {
        lines.push(`${idx + 1}) ${i.name} — ${i.qty} шт. — ${formatPrice(i.price * i.qty)}`);
      });
      lines.push("");
      lines.push(`Итого: ${formatPrice(cartTotal(cart))}`);
      lines.push("");
      lines.push("Размер(ы): ");
      lines.push("Город: ");
      lines.push("Доставка: ");
      lines.push("Комментарий: ");

      return encodeURIComponent(lines.join("\n"));
    }

    function shakeCartBtn() {
      const btn = $("cartBtn");
      if (!btn) return;
      btn.classList.remove("shake");
      void btn.offsetWidth;
      btn.classList.add("shake");
    }

    function goCheckout() {
      const msg = buildWhatsappMessage();
      if (!msg) {
        shakeCartBtn();
        alert("Корзина пустая. Добавь товары в разделе «Продукция».");
        return;
      }
      const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${msg}`;
      window.open(url, "_blank", "noopener,noreferrer");
    }

    function escapeHtml(str) {
      return String(str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;");
    }

    function prettyTextToHtml(text) {
      let safe = escapeHtml(text);
      return safe
        .replace(/\n{2,}/g, "\n\n")
        .split("\n\n")
        .map(block => `<p class="mb-3 last:mb-0">${block.replace(/\n/g, "<br>")}</p>`)
        .join("");
    }

    function renderProducts() {
      const grid = $("productGrid");

      grid.innerHTML = PRODUCTS.map(p => {
        const desc = p.description ? prettyTextToHtml(p.description) : "";
        const imgs = (p.images && p.images.length) ? p.images : [];

        return `
  <div class="w-full max-w-5xl border border-white/20 bg-black overflow-hidden product-card reveal">
    <div class="grid grid-cols-1 md:grid-cols-2 md:min-h-[560px]">

      <!-- LEFT: FULL-BLEED CAROUSEL -->
      <div class="bg-black md:h-[560px] overflow-hidden">
        <div class="carousel h-full">
          <button class="carousel-arrow carousel-prev" type="button" aria-label="Previous" data-id="${p.id}">‹</button>
          <button class="carousel-arrow carousel-next" type="button" aria-label="Next" data-id="${p.id}">›</button>

          <div class="carousel-track h-full" id="track-${p.id}" aria-label="Product images">
            ${imgs.map((img, idx) => `
              <div class="carousel-slide h-full">
                <img
                  src="${img}"
                  alt="${escapeHtml(p.name)} — ${idx + 1}"
                  loading="lazy"
                  decoding="async"
                />
              </div>
            `).join("")}
          </div>
          ${imgs.length > 1 ? `
  <div class="carousel-dots" id="dots-${p.id}" aria-label="Pagination">
    ${imgs.map((_, i) => `
      <button type="button"
        class="carousel-dot ${i === 0 ? "is-active" : ""}"
        aria-label="Go to image ${i + 1}"
        data-id="${p.id}"
        data-idx="${i}">
      </button>
    `).join("")}
  </div>
` : ""}

        </div>
      </div>

      <!-- RIGHT: INFO -->
      <div class="p-5 sm:p-6 md:p-8">
        <div class="flex items-start justify-between gap-4 sm:gap-6">
          <div class="min-w-0">
            <div class="text-base sm:text-lg md:text-xl font-semibold tracking-tight leading-snug break-words">
              ${escapeHtml(p.name)}
            </div>

            <div class="text-sm text-gray-400 mt-2 flex items-center gap-3 flex-wrap">
              <span class="helv-reg">${escapeHtml(p.note || "")}</span>

              <button type="button" onclick="openSizeGuide()"
                class="text-[10px] uppercase tracking-widest border border-white/20 px-3 py-1.5 hover:border-white transition helv-reg">
                Size guide
              </button>
            </div>
          </div>

          <div class="mono text-[11px] sm:text-xs uppercase tracking-widest text-gray-300 whitespace-nowrap pt-1">
            ${formatPrice(p.price)}
          </div>
        </div>

        ${p.description ? `
          <div class="mt-5 sm:mt-6 text-sm text-gray-300 leading-relaxed border-t border-white/20 pt-4 sm:pt-5">
            ${desc}
          </div>
        ` : ""}

        <div class="mt-6 sm:mt-8 grid grid-cols-1 sm:grid-cols-2 gap-3">
          <button onclick="addToCart('${p.id}')"
            class="bg-white text-black px-5 py-3 font-bold uppercase tracking-widest text-[12px] hover:opacity-90 transition">
            В корзину
          </button>

          <a target="_blank" rel="noopener noreferrer"
             href="https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent("QULTURE — хочу заказать: " + p.name)}"
             class="border border-white/20 px-5 py-3 font-bold uppercase tracking-widest text-[12px] text-center hover:border-white transition">
            WhatsApp
          </a>
        </div>
      </div>

    </div>
  </div>
`;

      }).join("");
    }

    function initCarousels() {
      PRODUCTS.forEach(p => {
        const track = document.getElementById(`track-${p.id}`);
        if (!track) return;

        const prevBtn = document.querySelector(`.carousel-prev[data-id="${p.id}"]`);
        const nextBtn = document.querySelector(`.carousel-next[data-id="${p.id}"]`);
        const total = (p.images && p.images.length) ? p.images.length : 1;
        const dotsWrap = document.getElementById(`dots-${p.id}`);


        function slideW() {
          return track.clientWidth || 1;
        }
        function idx() {
          const w = slideW();
          return Math.max(0, Math.min(total - 1, Math.round(track.scrollLeft / w)));
        }
        function updateArrows() {
          const i = idx();
          if (prevBtn) prevBtn.style.display = (i <= 0) ? "none" : "";
          if (nextBtn) nextBtn.style.display = (i >= total - 1) ? "none" : "";
          updateDots();
        }
        function updateDots() {
          if (!dotsWrap) return;
          const i = idx();
          dotsWrap.querySelectorAll(".carousel-dot").forEach((d, k) => {
            d.classList.toggle("is-active", k === i);
          });
        }
        function go(i) {
          const w = slideW();
          const clamped = Math.max(0, Math.min(total - 1, i));
          track.scrollTo({ left: clamped * w, behavior: "smooth" });
          setTimeout(updateArrows, 300);
        }

        // если одна фотка — прячем обе стрелки
        if (total <= 1) {
          if (prevBtn) prevBtn.style.display = "none";
          if (nextBtn) nextBtn.style.display = "none";
          return;
        }

        if (prevBtn) prevBtn.addEventListener("click", () => go(idx() - 1));
        if (nextBtn) nextBtn.addEventListener("click", () => go(idx() + 1));

        track.addEventListener("scroll", () => {
          window.requestAnimationFrame(updateArrows);
        }, { passive: true });

        window.addEventListener("resize", () => {
          const i = idx();
          track.scrollTo({ left: i * slideW(), behavior: "auto" });
          updateArrows();
        });

        if (dotsWrap) {
          dotsWrap.addEventListener("click", (e) => {
            const btn = e.target.closest(".carousel-dot");
            if (!btn) return;
            const to = Number(btn.dataset.idx);
            if (!Number.isFinite(to)) return;
            go(to);
          });
        }


        updateArrows();
      });
    }

    function renderCart() {
      const cart = loadCart();
      const wrap = $("cartItems");

      if (!cart.length) {
        wrap.innerHTML = `
          <div class="p-6 border border-white/20 bg-black text-gray-400">
            Корзина пустая. Добавь товары в «Продукция».
          </div>
        `;
      } else {
        wrap.innerHTML = cart.map(i => `
          <div class="p-5 border border-white/20 bg-black">
            <div class="flex items-start justify-between gap-4">
              <div>
                <div class="font-bold">${i.name}</div>
                <div class="text-sm text-gray-400 mt-1">${formatPrice(i.price)} / шт.</div>
              </div>
              <button class="mono text-[11px] uppercase tracking-widest text-gray-400 hover:text-white transition"
                onclick="removeFromCart('${i.id}')">Удалить</button>
            </div>

            <div class="mt-4 flex items-center justify-between">
              <div class="flex items-center gap-2">
                <button class="border border-white/20 w-10 h-10 hover:border-white transition" onclick="changeQty('${i.id}', -1)">-</button>
                <div class="mono text-[12px] uppercase tracking-widest text-gray-300 w-10 text-center">${i.qty}</div>
                <button class="border border-white/20 w-10 h-10 hover:border-white transition" onclick="changeQty('${i.id}', 1)">+</button>
              </div>
              <div class="font-bold">${formatPrice(i.price * i.qty)}</div>
            </div>
          </div>
        `).join("");
      }

      $("cartTotal").textContent = formatPrice(cartTotal(cart));
      renderCartBadge();
    }

    function openDrawer() {
      $("drawer").classList.remove("hidden");
      document.body.classList.add("overflow-hidden");
    }
    function closeDrawer() {
      $("drawer").classList.add("hidden");
      document.body.classList.remove("overflow-hidden");
    }

    const sizeModal = $("sizeModal");
    const sizeOverlay = $("sizeOverlay");
    const closeSize = $("closeSize");

    function openSizeGuide() {
      sizeModal.classList.add("is-open");
      document.body.classList.add("overflow-hidden");
    }
    function closeSizeGuide() {
      sizeModal.classList.remove("is-open");
      document.body.classList.remove("overflow-hidden");
    }

    sizeOverlay.addEventListener("click", closeSizeGuide);
    closeSize.addEventListener("click", closeSizeGuide);
    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && sizeModal.classList.contains("is-open")) closeSizeGuide();
    });
    window.openSizeGuide = openSizeGuide;

    function initReveal() {
      const els = Array.from(document.querySelectorAll(".reveal"));
      if (!("IntersectionObserver" in window)) {
        els.forEach(el => el.classList.add("is-in"));
        return;
      }

      const io = new IntersectionObserver((entries) => {
        entries.forEach(e => {
          if (e.isIntersecting) {
            e.target.classList.add("is-in");
            io.unobserve(e.target);
          }
        });
      }, { threshold: 0.12 });

      els.forEach((el, idx) => {
        if (!el.classList.contains("delay-1") && !el.classList.contains("delay-2") && !el.classList.contains("delay-3")) {
          const mod = idx % 4;
          if (mod === 1) el.classList.add("delay-1");
          if (mod === 2) el.classList.add("delay-2");
          if (mod === 3) el.classList.add("delay-3");
        }
        io.observe(el);
      });
    }

    $("cartBtn").addEventListener("click", () => { openDrawer(); renderCart(); });
    $("closeDrawer").addEventListener("click", closeDrawer);
    $("drawerOverlay").addEventListener("click", closeDrawer);
    $("drawerCheckout").addEventListener("click", goCheckout);
    $("clearCart").addEventListener("click", clearCart);

    window.addToCart = addToCart;
    window.removeFromCart = removeFromCart;
    window.changeQty = changeQty;

    renderProducts();
    initCarousels();
    renderCartBadge();
    renderCart();
    initReveal();
  </script>

</body>

</html>